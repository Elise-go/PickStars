{"version":3,"sources":["assets\\scripts\\Game.js"],"names":["cc","Class","Component","properties","playBtn","type","Node","againBtn","gameOverNode","player","starPrefab","Prefab","maxStarDuration","minStarDuration","ground","scoreDisplay","Label","scoreFXPrefab","scoreAudio","AudioClip","onLoad","isPlaying","timer","starDuration","starPool","NodePool","scorePool","currentStar","groundY","y","height","onStartGame","destroy","active","getComponent","startMoveAt","v2","spawnNewStar","resetScore","newStar","size","get","instantiate","node","addChild","setPosition","getNewStarPosition","init","startTimer","starNode","randY","Math","random","jumpHeight","maxX","width","randX","score","string","gainScore","pos","audioEngine","playEffect","fx","spawnScoreFX","Animation","play","despawnScoreFX","scoreFX","put","despawnStar","star","update","dt","gameOver","enabled","stopAllActions"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAGLC,UAAU,EAAE;IAER;IACAC,OAAO,EAAC;MACJ,WAAQ,IADJ;MAEJC,IAAI,EAACL,EAAE,CAACM;IAFJ,CAHA;IAORC,QAAQ,EAAC;MACL,WAAQ,IADH;MAELF,IAAI,EAACL,EAAE,CAACM;IAFH,CAPD;IAWRE,YAAY,EAAC;MACT,WAAQ,IADC;MAETH,IAAI,EAACL,EAAE,CAACM;IAFC,CAXL;;IAiBP;IACD;IACAG,MAAM,EAAC;MACH,WAAQ,IADL;MAEHJ,IAAI,EAACL,EAAE,CAACM;IAFL,CAnBC;;IAyBR;IACA;IACAI,UAAU,EAAC;MACP,WAAQ,IADD;MAEPL,IAAI,EAACL,EAAE,CAACW;IAFD,CA3BH;IA+BR;IACAC,eAAe,EAAC,CAhCR;IAiCRC,eAAe,EAAC,CAjCR;IAkCR;IACAC,MAAM,EAAC;MACH,WAAQ,IADL;MAEHT,IAAI,EAACL,EAAE,CAACM;IAFL,CAnCC;;IAyCR;IACAS,YAAY,EAAC;MACT,WAAQ,IADC;MAETV,IAAI,EAACL,EAAE,CAACgB;IAFC,CA1CL;IA8CR;IACAC,aAAa,EAAC;MACV,WAAQ,IADE;MAEVZ,IAAI,EAACL,EAAE,CAACW;IAFE,CA/CN;IAmDRO,UAAU,EAAC;MACP,WAAQ,IADD;MAEPb,IAAI,EAACL,EAAE,CAACmB;IAFD;EAnDH,CAHP;EA6DLC,MAAM,EAAC,kBAAU;IAEb;IACA,KAAKC,SAAL,GAAiB,KAAjB,CAHa,CAKb;;IACA,KAAKC,KAAL,GAAa,CAAb;IACA,KAAKC,YAAL,GAAmB,CAAnB,CAPa,CASb;;IACA,KAAKC,QAAL,GAAgB,IAAIxB,EAAE,CAACyB,QAAP,CAAgB,MAAhB,CAAhB;IACA,KAAKC,SAAL,GAAiB,IAAI1B,EAAE,CAACyB,QAAP,CAAgB,WAAhB,CAAjB,CAXa,CAab;;IACA,KAAKE,WAAL,GAAmB,IAAnB,CAda,CAgBZ;;IACA,KAAKC,OAAL,GAAe,KAAKd,MAAL,CAAYe,CAAZ,GAAgB,KAAKf,MAAL,CAAYgB,MAAZ,GAAmB,CAAlD;EAEJ,CAhFI;;EAkFL;EACAC,WAnFK,yBAmFQ;IAAG;IAEZ,KAAKV,SAAL,GAAiB,IAAjB,CAFS,CAIT;;IACA,KAAKjB,OAAL,CAAa4B,OAAb;IACA,KAAKzB,QAAL,CAAc0B,MAAd,GAAuB,KAAvB;IACA,KAAKzB,YAAL,CAAkByB,MAAlB,GAA2B,KAA3B,CAPS,CAST;;IACA,KAAKxB,MAAL,CAAYyB,YAAZ,CAAyB,QAAzB,EAAmCC,WAAnC,CAA+CnC,EAAE,CAACoC,EAAH,CAAM,CAAN,EAAQ,KAAKR,OAAb,CAA/C,EAVS,CAYT;;IACA,KAAKS,YAAL,GAbS,CAeT;;IACA,KAAKC,UAAL;EACH,CApGI;EAsGLD,YAtGK,0BAsGS;IAEX,IAAIE,OAAO,GAAG,IAAd,CAFW,CAES;;IACpB,IAAG,KAAKf,QAAL,CAAcgB,IAAd,KAAuB,CAA1B,EAA6B;MAC5BD,OAAO,GAAG,KAAKf,QAAL,CAAciB,GAAd,CAAkB,IAAlB,CAAV;IACA,CAFD,MAEK;MACJF,OAAO,GAAGvC,EAAE,CAAC0C,WAAH,CAAe,KAAKhC,UAApB,CAAV;IACA,CAPU,CASV;;;IACA,KAAKiC,IAAL,CAAUC,QAAV,CAAmBL,OAAnB,EAVU,CAWV;;IACAA,OAAO,CAACM,WAAR,CAAoB,KAAKC,kBAAL,CAAwBP,OAAxB,CAApB,EAZU,CAaV;;IACAA,OAAO,CAACL,YAAR,CAAqB,MAArB,EAA6Ba,IAA7B,CAAkC,IAAlC,EAdU,CAeV;;IACA,KAAKC,UAAL;IAEA,KAAKrB,WAAL,GAAmBY,OAAnB;EACH,CAzHI;EA0HLO,kBA1HK,8BA0HcG,QA1Hd,EA0HuB;IAAG;IAC3B,IAAIC,KAAK,GAAG,KAAKtB,OAAL,GAAeuB,IAAI,CAACC,MAAL,KAAc,KAAK3C,MAAL,CAAYyB,YAAZ,CAAyB,QAAzB,EAAmCmB,UAAhE,GAA6E,EAAzF;IACA,IAAIC,IAAI,GAAG,KAAKX,IAAL,CAAUY,KAAV,GAAgB,CAAhB,GAAoBN,QAAQ,CAACM,KAAT,GAAe,CAA9C;IACA,IAAIC,KAAK,GAAG,CAACL,IAAI,CAACC,MAAL,KAAc,GAAf,IAAoB,CAApB,GAAsBE,IAAlC;IACA,OAAOtD,EAAE,CAACoC,EAAH,CAAMoB,KAAN,EAAYN,KAAZ,CAAP;EACH,CA/HI;EAgILF,UAhIK,wBAgIO;IAAE;IACV,KAAKzB,YAAL,GAAoB,KAAKV,eAAL,GAAuBsC,IAAI,CAACC,MAAL,MAAe,KAAKxC,eAAL,GAAuB,KAAKC,eAA3C,CAA3C;IACA,KAAKS,KAAL,GAAa,CAAb;EACH,CAnII;EAqILgB,UArIK,wBAqIO;IACR,KAAKmB,KAAL,GAAa,CAAb;IACA,KAAK1C,YAAL,CAAkB2C,MAAlB,GAA2B,UAA3B;EACH,CAxII;;EA0IL;EAGAC,SA7IK,qBA6IKC,GA7IL,EA6IS;IAAG;IACb,KAAKH,KAAL,IAAc,CAAd,CADU,CAEV;;IACA,KAAK1C,YAAL,CAAkB2C,MAAlB,GAA2B,YAAW,KAAKD,KAA3C,CAHU,CAIV;;IACAzD,EAAE,CAAC6D,WAAH,CAAeC,UAAf,CAA0B,KAAK5C,UAA/B,EAA0C,KAA1C,EALU,CAMV;;IACA,IAAI6C,EAAE,GAAG,KAAKC,YAAL,EAAT;IACA,KAAKrB,IAAL,CAAUC,QAAV,CAAmBmB,EAAnB;IACAA,EAAE,CAAClB,WAAH,CAAee,GAAf;IACAG,EAAE,CAAC7B,YAAH,CAAgBlC,EAAE,CAACiE,SAAnB,EAA8BC,IAA9B,CAAmC,WAAnC;EAEH,CAzJI;EA2JLF,YA3JK,0BA2JS;IACV,IAAID,EAAJ;;IACA,IAAG,KAAKrC,SAAL,CAAec,IAAf,KAAsB,CAAzB,EAA2B;MACvBuB,EAAE,GAAG,KAAKrC,SAAL,CAAee,GAAf,CAAmB,IAAnB,CAAL;IACH,CAFD,MAEK;MACDsB,EAAE,GAAG/D,EAAE,CAAC0C,WAAH,CAAe,KAAKzB,aAApB,CAAL;MACA8C,EAAE,CAAC7B,YAAH,CAAgB,WAAhB,EAA6Ba,IAA7B,CAAkC,IAAlC;IACH;;IACD,OAAOgB,EAAP;EACH,CApKI;EAsKLI,cAtKK,0BAsKUC,OAtKV,EAsKkB;IAAG;IACtB,KAAK1C,SAAL,CAAe2C,GAAf,CAAmBD,OAAnB;EACH,CAxKI;EA2KLE,WA3KK,uBA2KOC,IA3KP,EA2KY;IAAG;IAChB,KAAK/C,QAAL,CAAc6C,GAAd,CAAkBE,IAAlB;IACA,KAAKlC,YAAL;EACH,CA9KI;EAgLLmC,MAAM,EAAC,gBAASC,EAAT,EAAY;IACf;IACA,IAAG,CAAC,KAAKpD,SAAT,EAAoB,OAFL,CAIf;;IACA,IAAG,KAAKC,KAAL,GAAa,KAAKC,YAArB,EAAkC;MAC9B,KAAKmD,QAAL;MACA;IACH;;IAED,KAAKpD,KAAL,IAAcmD,EAAd;EACH,CA3LI;EA6LLC,QA7LK,sBA6LK;IACN,KAAKrD,SAAL,GAAiB,KAAjB;IAEA,KAAKd,QAAL,CAAc0B,MAAd,GAAuB,IAAvB;IACA,KAAKzB,YAAL,CAAkByB,MAAlB,GAA2B,IAA3B;IAEA,KAAKxB,MAAL,CAAYyB,YAAZ,CAAyB,QAAzB,EAAmCyC,OAAnC,GAA6C,KAA7C;IACA,KAAKlE,MAAL,CAAYmE,cAAZ;IAEA,KAAKjD,WAAL,CAAiBK,OAAjB;EAEH;AAxMI,CAAT","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        /*********菜单模块*********/\n        playBtn:{\n            default:null,\n            type:cc.Node\n        },\n        againBtn:{\n            default:null,\n            type:cc.Node\n        },\n        gameOverNode:{\n            default:null,\n            type:cc.Node\n        },\n\n\n         /*********主角模块*********/\n        //Player节点，用于获取主角弹跳高度，和控制主角行动开关\n        player:{\n            default:null,\n            type:cc.Node\n        },\n\n\n        /*********星星模块*********/\n        //引用星星的预制资源\n        starPrefab:{\n            default:null,\n            type:cc.Prefab\n        },\n        //星星产生后消失时间的随机范围\n        maxStarDuration:0,\n        minStarDuration:0,\n        //地面节点，用于确定星星生成的高度\n        ground:{\n            default:null,\n            type:cc.Node\n        },\n\n\n        /*********分数模块*********/\n        scoreDisplay:{\n            default:null,\n            type:cc.Label\n        },\n        //引用分数效果的预制资源\n        scoreFXPrefab:{\n            default:null,\n            type:cc.Prefab\n        },\n        scoreAudio:{\n            default:null,\n            type:cc.AudioClip\n          }\n\n    },\n\n    onLoad:function(){\n\n        //设置游戏页面状态 (Playing or show menu)\n        this.isPlaying = false;\n\n        //初始化计时器\n        this.timer = 0;\n        this.starDuration =0;\n\n        //initialize star and score pool\n        this.starPool = new cc.NodePool('Star');\n        this.scorePool = new cc.NodePool('ScoreAnim');\n\n        // 保存当前星星节点以便销毁\n        this.currentStar = null;\n\n         //获取地平面的y轴坐标\n         this.groundY = this.ground.y + this.ground.height/2;\n    \n    },\n\n    /************onStartGame()开始***************/\n    onStartGame(){  //Button组件 Click Events属性设置\n\n        this.isPlaying = true;\n        \n        // set button and gameover text out of screen \n        this.playBtn.destroy();\n        this.againBtn.active = false;\n        this.gameOverNode.active = false;\n\n        //重置玩家位置和移动速度\n        this.player.getComponent('Player').startMoveAt(cc.v2(0,this.groundY));\n\n        //生成星星\n        this.spawnNewStar();\n\n        // 重置计分\n        this.resetScore();\n    },\n\n    spawnNewStar(){  \n\n       var newStar = null; //node节点\n       if(this.starPool.size() > 0 ){\n        newStar = this.starPool.get(this);\n       }else{\n        newStar = cc.instantiate(this.starPrefab);\n       }\n\n        //将新增节点添加到Canvas节点下面\n        this.node.addChild(newStar);\n        //为星星设置一个随机位置\n        newStar.setPosition(this.getNewStarPosition(newStar));\n        // pasee Game instance to Star\n        newStar.getComponent('Star').init(this);\n        //给星星设置计时器\n        this.startTimer();\n\n        this.currentStar = newStar;  \n    },\n    getNewStarPosition(starNode){  //spawnNewStar()调用\n        var randY = this.groundY + Math.random()*this.player.getComponent('Player').jumpHeight + 50;\n        var maxX = this.node.width/2 - starNode.width/2;\n        var randX = (Math.random()-0.5)*2*maxX;\n        return cc.v2(randX,randY);\n    },\n    startTimer(){ //spawnNewStar()调用\n        this.starDuration = this.minStarDuration + Math.random()*(this.maxStarDuration - this.minStarDuration);\n        this.timer = 0;\n    },\n\n    resetScore(){  \n        this.score = 0;\n        this.scoreDisplay.string = 'Score: 0';\n    },\n\n    /************onStartGame()结束***************/\n\n\n    gainScore(pos){  //Star.js--onPicked()调用\n        this.score += 1;\n        //更新 scoreDisplay Label的文字\n        this.scoreDisplay.string = 'Score: '+ this.score;\n        //播放得分音效\n        cc.audioEngine.playEffect(this.scoreAudio,false);\n        //播放特效\n        var fx = this.spawnScoreFX();\n        this.node.addChild(fx);\n        fx.setPosition(pos);\n        fx.getComponent(cc.Animation).play('score_pop');\n\n    },\n\n    spawnScoreFX(){\n        var fx;\n        if(this.scorePool.size()>0){\n            fx = this.scorePool.get(this);\n        }else{\n            fx = cc.instantiate(this.scoreFXPrefab);\n            fx.getComponent('ScoreAnim').init(this);\n        }\n        return fx;\n    },\n\n    despawnScoreFX(scoreFX){  //作为动画播放最后一帧的回调函数\n        this.scorePool.put(scoreFX);\n    },\n\n\n    despawnStar(star){  //Star.js--onPicked()调用\n        this.starPool.put(star);\n        this.spawnNewStar();\n    },\n    \n    update:function(dt){\n        //若isPlaying==false,则往下代码不会执行，直接退出update\n        if(!this.isPlaying) return;\n\n        //每帧更新计时器，超时还未生成新的星星就会调用游戏失败逻辑\n        if(this.timer > this.starDuration){\n            this.gameOver();\n            return;\n        }\n\n        this.timer += dt;\n    },\n\n    gameOver(){\n        this.isPlaying = false;\n\n        this.againBtn.active = true;\n        this.gameOverNode.active = true;\n\n        this.player.getComponent('Player').enabled = false;\n        this.player.stopAllActions();\n       \n        this.currentStar.destroy();\n        \n    }\n\n\n});\n"]}