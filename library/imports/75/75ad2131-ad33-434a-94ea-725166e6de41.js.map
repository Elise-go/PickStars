{"version":3,"sources":["assets\\scripts\\Game.js"],"names":["cc","Class","Component","properties","playBtn","type","Node","againBtn","gameOverNode","rules","player","starPrefab","Prefab","maxStarDuration","minStarDuration","ground","scoreNode","scoreDisplay","Label","scoreFXPrefab","scoreAudio","AudioClip","onLoad","isPlaying","timer","starDuration","starPool","NodePool","scorePool","currentStar","groundY","y","height","onStartGame","isValid","destroy","active","getComponent","startMoveAt","v2","spawnNewStar","resetScore","newStar","size","get","instantiate","node","addChild","setPosition","getNewStarPosition","init","startTimer","starNode","randY","Math","random","jumpHeight","maxX","width","randX","score","string","gainScore","pos","audioEngine","playEffect","fx","spawnScoreFX","Animation","play","despawnScoreFX","scoreFX","put","despawnStar","star","update","dt","gameOver","enabled","stopAllActions"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        /*********菜单模块*********/\n        playBtn:{\n            default:null,\n            type:cc.Node\n        },\n        againBtn:{\n            default:null,\n            type:cc.Node\n        },\n        gameOverNode:{\n            default:null,\n            type:cc.Node\n        },\n        rules:{\n            default:null,\n            type:cc.Node\n        },\n\n\n         /*********主角模块*********/\n        //Player节点，用于获取主角弹跳高度，和控制主角行动开关\n        player:{\n            default:null,\n            type:cc.Node\n        },\n\n\n        /*********星星模块*********/\n        //引用星星的预制资源\n        starPrefab:{\n            default:null,\n            type:cc.Prefab\n        },\n        //星星产生后消失时间的随机范围\n        maxStarDuration:0,\n        minStarDuration:0,\n        //地面节点，用于确定星星生成的高度\n        ground:{\n            default:null,\n            type:cc.Node\n        },\n\n\n        /*********分数模块*********/\n        scoreNode:{\n            default:null,\n            type:cc.Node\n        },\n        scoreDisplay:{\n            default:null,\n            type:cc.Label\n        },\n        //引用分数效果的预制资源\n        scoreFXPrefab:{\n            default:null,\n            type:cc.Prefab\n        },\n        scoreAudio:{\n            default:null,\n            type:cc.AudioClip\n          }\n\n    },\n\n    onLoad:function(){\n\n        //设置游戏页面状态 (Playing or show menu)\n        this.isPlaying = false;\n\n        //初始化计时器\n        this.timer = 0;\n        this.starDuration =0;\n\n        //initialize star and score pool\n        this.starPool = new cc.NodePool('Star');\n        this.scorePool = new cc.NodePool('ScoreAnim');\n\n        // 保存当前星星节点以便销毁\n        this.currentStar = null;\n\n         //获取地平面的y轴坐标\n         this.groundY = this.ground.y + this.ground.height/2;\n    \n    },\n\n    /************onStartGame()开始***************/\n    onStartGame(){  //Button组件 Click Events属性设置\n\n        this.isPlaying = true;\n        \n        if(this.playBtn.isValid){\n            this.playBtn.destroy();\n        }\n\n        if(this.rules.isValid){\n            this.rules.destroy();\n        }\n\n        if(!this.scoreNode.active){\n            this.scoreNode.active = true;\n        }\n\n        this.againBtn.active = false;\n        this.gameOverNode.active = false;\n\n        //重置玩家位置和移动速度\n        this.player.getComponent('Player').startMoveAt(cc.v2(0,this.groundY));\n\n        //生成星星\n        this.spawnNewStar();\n\n        // 重置计分\n        this.resetScore();\n\n    },\n\n    spawnNewStar(){  \n\n       var newStar = null; //node节点\n       if(this.starPool.size() > 0 ){\n        newStar = this.starPool.get(this);\n       }else{\n        newStar = cc.instantiate(this.starPrefab);\n       }\n\n        //将新增节点添加到Canvas节点下面\n        this.node.addChild(newStar);\n        //为星星设置一个随机位置\n        newStar.setPosition(this.getNewStarPosition(newStar));\n        // pasee Game instance to Star\n        newStar.getComponent('Star').init(this);\n        //给星星设置计时器\n        this.startTimer();\n\n        this.currentStar = newStar;  \n    },\n    getNewStarPosition(starNode){  //spawnNewStar()调用\n        var randY = this.groundY + Math.random()*this.player.getComponent('Player').jumpHeight + 50;\n        var maxX = this.node.width/2 - starNode.width/2;\n        var randX = (Math.random()-0.5)*2*maxX;\n        return cc.v2(randX,randY);\n    },\n    startTimer(){ //spawnNewStar()调用\n        this.starDuration = this.minStarDuration + Math.random()*(this.maxStarDuration - this.minStarDuration);\n        this.timer = 0;\n    },\n\n    resetScore(){  \n        this.score = 0;\n        this.scoreDisplay.string = 'Score: 0';\n    },\n\n    /************onStartGame()结束***************/\n\n\n    gainScore(pos){  //Star.js--onPicked()调用\n        this.score += 1;\n        //更新 scoreDisplay Label的文字\n        this.scoreDisplay.string = 'Score: '+ this.score;\n        //播放得分音效\n        cc.audioEngine.playEffect(this.scoreAudio,false);\n        //播放特效\n        var fx = this.spawnScoreFX();\n        this.node.addChild(fx);\n        fx.setPosition(pos);\n        fx.getComponent(cc.Animation).play('score_pop');\n\n    },\n\n    spawnScoreFX(){\n        var fx;\n        if(this.scorePool.size()>0){\n            fx = this.scorePool.get(this);\n        }else{\n            fx = cc.instantiate(this.scoreFXPrefab);\n            fx.getComponent('ScoreAnim').init(this);\n        }\n        return fx;\n    },\n\n    despawnScoreFX(scoreFX){  //作为动画播放最后一帧的回调函数\n        this.scorePool.put(scoreFX);\n    },\n\n\n    despawnStar(star){  //Star.js--onPicked()调用\n        this.starPool.put(star);\n        this.spawnNewStar();\n    },\n    \n    update:function(dt){\n        //若isPlaying==false,则往下代码不会执行，直接退出update\n        if(!this.isPlaying) return;\n\n        //每帧更新计时器，超时还未生成新的星星就会调用游戏失败逻辑\n        if(this.timer > this.starDuration){\n            this.gameOver();\n            return;\n        }\n\n        this.timer += dt;\n    },\n\n    gameOver(){\n        this.isPlaying = false;\n\n        this.againBtn.active = true;\n        this.gameOverNode.active = true;\n\n        this.player.getComponent('Player').enabled = false;\n        this.player.stopAllActions();\n       \n        this.currentStar.destroy();\n        \n    }\n\n\n});\n"]}